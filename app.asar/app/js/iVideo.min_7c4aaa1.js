var egret;!function(t){var e;!function(e){var i=function(e){function i(i){var o=e.call(this)||this;return o.video=i,o.loaded=!1,o.closed=!1,o.heightSet=0/0,o.widthSet=0/0,o.waiting=!1,o.userPause=!1,o.userPlay=!1,o.isPlayed=!1,o._fullscreen=!0,o.$renderNode=new t.sys.BitmapNode,o.timer=new t.Timer(33,0),o.timer.addEventListener(t.TimerEvent.TIMER,this.markDirty,this),o}return __extends(i,e),i.prototype.running=function(){return this.timer.running},i.prototype.play=function(t,e){this.isPlayed=!0,this.timer.start()},i.prototype.videoPlay=function(){return this.userPause=!1,this.waiting?void(this.userPlay=!0):(this.userPlay=!1,void this.video.play())},i.prototype.screenError=function(){t.$error(3014)},i.prototype.onVideoEnded=function(){this.isPlayed=!1,this.dispatchEventWith(t.Event.ENDED)},i.prototype.onVideoError=function(){this.dispatchEventWith(t.IOErrorEvent.IO_ERROR)},i.prototype.pause=function(){return this.userPlay=!1,this.waiting?void(this.userPause=!0):(this.userPause=!1,void this.timer.stop())},i.prototype.destory=function(){this.timer=null},Object.defineProperty(i.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){this.video&&(this.video.volume=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video&&(this.video.currentTime=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bitmapData",{get:function(){return this.video?(this._bitmapData||(this.video.width=this.video.videoWidth,this.video.height=this.video.videoHeight,this._bitmapData=new t.BitmapData(this.video),this._bitmapData.$deleteSource=!1),this._bitmapData):null},enumerable:!0,configurable:!0}),i.prototype.loadPoster=function(){var e=this,i=this.poster;if(i){var o=new t.ImageLoader;o.once(t.Event.COMPLETE,function(t){o.data;e.posterData=o.data,e.$renderDirty=!0,e.posterData.width=e.getPlayWidth(),e.posterData.height=e.getPlayHeight()},this),o.load(i)}},i.prototype.$measureContentBounds=function(t){var e=this.bitmapData,i=this.posterData;e?t.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):i?t.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):t.setEmpty()},i.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},i.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},i.prototype.$updateRenderNode=function(){if(this.video.paused||this.video.readyState<1||0===this.video.currentTime||this.video.ended)return void(this.$renderDirty=!1);var e=this.$renderNode,i=this.bitmapData,o=(this.posterData,this.getPlayWidth()),r=this.getPlayHeight();if(e.image=i,e.imageWidth=i.width,e.imageHeight=i.height,i.webGLTexture){var h=t.web.WebGLRenderContext.getInstance().context,a=0,s=h.RGBA,n=h.RGBA,d=h.UNSIGNED_BYTE;h.bindTexture(h.TEXTURE_2D,i.webGLTexture),h.texImage2D(h.TEXTURE_2D,a,s,n,d,this.video)}else t.WebGLUtils.deleteWebGLTexture(i.webGLTexture),i.webGLTexture=null;var p=o/i.width,u=r/i.height,l=Math.min(p,u),y=Math.floor((o-i.width*l)/2),g=Math.floor((r-i.height*l)/2),c=Math.floor(i.width*l),v=Math.floor(i.height*l);e.drawImage(0,0,i.width,i.height,y,g,c,v)},i.prototype.markDirty=function(){!this.video.ended&&!this.video.paused&&this.video.readyState>1&&this.video.currentTime>.1?this.$renderDirty=!0:this.$renderDirty=!1},i.prototype["switch"]=function(t){this.video=t,this.waiting=!1},i.prototype.$setHeight=function(t){this.heightSet=t,e.prototype.$setHeight.call(this,t)},i.prototype.$setWidth=function(t){this.widthSet=t,e.prototype.$setWidth.call(this,t)},Object.defineProperty(i.prototype,"paused",{get:function(){return this.video?this.video.paused:!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){if(this.video)return this.video.duration;throw new Error("Video not loaded!")},enumerable:!0,configurable:!0}),i}(t.DisplayObject);e.WebVideo=i,__reflect(i.prototype,"egret.web.WebVideo",["egret.iVideo","egret.DisplayObject"]),t.iVideo=i}(e=t.web||(t.web={}))}(egret||(egret={}));