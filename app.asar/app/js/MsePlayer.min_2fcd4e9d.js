var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{o(r.next(e))}catch(t){a(t)}}function u(e){try{o(r["throw"](e))}catch(t){a(t)}}function o(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,u)}o((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,a&&(s=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(s=o.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(r){n=[6,r],a=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,s,u,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),u=r(s),o=function(){function e(){i(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return a(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new Error("not supported");if("uuid"===this.type)for(var t=[],n=0;16>n;n++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var n=this.size-t.position+this.start,r=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength;var i=void 0;i=e.containerBox.find(function(e){return e===r})?e.containerParser:e[r],i&&i instanceof Function&&i.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new u["default"](this.data),n=t.buffer.byteLength,r=this;t.position<n;){var i=new e;i.readHeader(t),r.subBox.push(i),i.readBody(t)}delete r.data,t=null}}]),e}();o.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){if(r(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return i(e,[{key:"skip",value:function(t){for(var n=Math.floor(t/4),r=t%4,i=0;n>i;i++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var r=void 0;switch(t){case 1:r=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw"not supported for readByte 3";r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw"not supported for readBody 8";r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";var r,i,a,s,u,o,f,d=n(12),l=n(26),c=Function.prototype.apply,h=Function.prototype.call,p=Object.create,v=Object.defineProperty,m=Object.defineProperties,y=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var n;return l(t),y.call(this,"__ee__")?n=this.__ee__:(n=g.value=p(null),v(this,"__ee__",g),g.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},i=function(e,t){var n,i;return l(t),i=this,r.call(this,e,n=function(){a.call(i,e,n),c.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a=function(e,t){var n,r,i,a;if(l(t),!y.call(this,"__ee__"))return this;if(n=this.__ee__,!n[e])return this;if(r=n[e],"object"==typeof r)for(a=0;i=r[a];++a)(i===t||i.__eeOnceListener__===t)&&(2===r.length?n[e]=r[a?0:1]:r.splice(a,1));else(r===t||r.__eeOnceListener__===t)&&delete n[e];return this},s=function(e){var t,n,r,i,a;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,a=new Array(n-1),t=1;n>t;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)c.call(r,this,a)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),t=1;n>t;++t)a[t-1]=arguments[t];c.call(i,this,a)}},u={on:r,once:i,off:a,emit:s},o={on:d(r),once:d(i),off:d(a),emit:d(s)},f=m({},o),e.exports=t=function(e){return null==e?p(f):m(Object(e),o)},t.methods=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(5),u=r(s),o=function(){function e(){i(this,e),this.buffer=new Uint8Array(0)}return a(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];n.forEach(function(t){t?e.buffer=(0,u["default"])(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";var r=n(19)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(30),a=r(i);e.exports=a["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),u=r(s),o=n(7),f=r(o),d=function(){function e(t,n,r){i(this,e),console.log(n),r||(r=n,n=void 0),(0,u["default"])(this),this.url=t,n&&(this.range=n,this.id=n.join("-")),this.on=!1;var a=new window.XMLHttpRequest;a.target=this,a.responseType="arraybuffer",a.open("get",t),n&&a.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]),a.onload=function(){(200===a.status||206===a.status)&&r&&r instanceof Function&&r(a.response),a.target.remove()},a.onerror=function(e){a.target.emit("error",new f["default"]("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),a.target.remove()},a.onabort=function(){a.target.remove()},this.xhr=a,e.queue.push(this),this.update()}return a(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(n,r){return n.url===t.url&&!t.range||t.range&&n.url===t.url&&n.id===t.id?(e.queue.splice(r,1),!0):!1}),this.update()}},{key:"update",value:function(){var t=e.queue,n=t.filter(function(e){return e.on}),r=t.filter(function(e){return!e.on}),i=e.limit-n.length;r.forEach(function(e,t){i>t&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(t){if(console.log("清理 url = "+t),t){var n=!1,r=-1;e.queue.forEach(function(e,i){e.url===t&&(e&&e.cancel(),n=!0,r=i)}),n&&e.queue.splice(r,1)}else e.queue.forEach(function(e){e&&e.cancel()}),e.queue=[]}}]),e}();d.queue=[],d.limit=2,window.Task=d,t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s={network:{code:1,msg:"视频下载错误",remark:"只要视频下载错误就使用此类型，无论是video本身的超时还是xhr的分段请求超时或者资源不存在"},mse:{code:2,msg:"流追加错误",remark:"追加流的时候如果类型不对、无法被正确解码则会触发此类错误"},parse:{code:3,msg:"解析错误",remark:"mp4、hls、flv我们都是使用js进行格式解析，如果解析失败则会触发此类错误"},format:{code:4,msg:"格式错误",remark:"如果浏览器不支持的格式导致播放错误"},decoder:{code:5,msg:"解码错误",remark:"浏览器解码异常会抛出此类型错误"},runtime:{code:6,msg:"语法错误",remark:"播放器语法错误"},timeout:{code:7,msg:"播放超时",remark:"播放过程中无法正常请求下一个分段导致播放中断"},other:{code:8,msg:"其他错误",remark:"不可知的错误或被忽略的错误类型"}},u=function f(e,t,n,r,i,u,o,d){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{line:"",handle:"",msg:"",version:""};a(this,f);var c={};return c.errorType=e,c.domain=document.domain,c.duration=n,c.currentTime=t,c.networkState=r,c.readyState=i,c.currentSrc=o,c.src=u,c.ended=d,c.errd=l,c.ex=(s[e]||{}).msg,c},o=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";a(this,t);var u=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return u.url=s,u}return i(t,e),t}(u);t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){r(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return i(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(5),u=r(s),o=n(31),f=r(o),d=n(32),l=r(d),c={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]},h=function(e){var t=e.readUint32(),n=[],r=void 0,i=!0,a=!1;if(1===t){do{if(r=e.readUint8(),!a){if(7!==(31&r)){i=!1,e.back(5);break}a=!0}0!==r?n.push(r):(r=e.readUint24(),1===r?(i=!1,e.back(4)):(e.back(4),n.push(e.readUint8())))}while(i)}else e.back(4);return n},p=function(e){var t=e.readUint32(),n=[],r=void 0,i=!0,a=!1;if(1===t){do{if(r=e.readUint8(),!a){if(8!==(31&r)){i=!1,e.back(5);break}a=!0}0!==r?n.push(r):(r=e.readUint16(),1===r?(i=!1,e.back(3)):(e.back(3),n.push(e.readUint8())))}while(i)}else e.back(4);return n},v=function(){function e(t){i(this,e);var n=new f["default"](t);this.header=new e.Header(n),this.body=new e.Payload(n,this)}return a(e,null,[{key:"Header",value:function(e){this.sync=e.readUint8();var t=e.readUint16();this.error=t>>>15,this.payload=t>>>14&1,this.priority=t>>>13&1,this.pid=8191&t,t=e.readUint8(),this.scrambling=t>>6&3,this.adaptation=t>>4&3,this.continuity=15&t,this.packet=0===this.pid?"PAT":"MEDIA"}},{key:"Payload",value:function(t,n){var r=n.header,i=r.pid,a=void 0;switch(i){case 0:a=new e.PAT(t);break;case 1:a=new e.CAT(t);break;case 2:a=new e.TSDT(t);break;case 8191:a=!1;break;default:if(e.PATSpace.some(function(e){return e.pid===i}))a=new e.PMT(t,n);else{var s=e.PMTSpace?e.PMTSpace.filter(function(e){return e.pid===i}):[];a=s.length?new e.Media(t,n,c[s[0].streamType][0]):!1}}return a}},{key:"PAT",value:function(t){var n=t.readUint8();t.skip(n),n=t.readUint8(),this.tabelID=n,n=t.readUint16(),this.error=n>>>7,this.zero=n>>>6&1,this.sectionLength=4095&n,this.streamID=t.readUint16(),this.current=1&t.readUint8(),this.sectionNumber=t.readUint8(),this.lastSectionNumber=t.readUint8();for(var r=(this.sectionLength-9)/4,i=[],a=0;r>a;a++){var s=t.readUint16(),u=8191&t.readUint16();i.push({program:s,pid:u,type:0===s?"network":"mapPID"})}this.list=i,e.PATSpace=e.PATSpace.concat(i),this.program=t.readUint16(),this.pid=8191&t.readUint16(),t.dataview.byteLength-t.position>=4&&(this.crc32=t.readUint32())}},{key:"PMT",value:function(t,n){var r=this;n.header.packet="PMT";var i=t.readUint8();t.skip(i),i=t.readUint8(),this.tableID=i,i=t.readUint16(),this.sectionLength=4095&i,this.program=t.readUint16(),this.current=1&t.readUint8(),this.order=t.readUint8(),this.lastOrder=t.readUint8(),this.PCR_PID=8191&t.readUint16(),this.programLength=4095&t.readUint16();for(var a=(this.sectionLength-13)/5,s=[],u=0;a>u;u++)s.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});this.list=s,e.PMTSpace||(e.PMTSpace=[]),e.PMTSpace=e.PMTSpace.concat(s.map(function(e){return{pid:e.pid,es:e.es,streamType:e.streamType,program:r.program}})),t.dataview.byteLength-t.position>=4&&(this.crc32=t.readUint32())}},{key:"Media",value:function(e,t,n){var r=t.header;if(this.start=e.position,this.type=n,3===r.adaptation&&(this.adaptationLength=e.readUint8(),this.adaptationLength>0)){var i=e.readUint8();this.discontinue=i>>>7,this.access=i>>>6&1,this.priority=i>>>5&1,this.PCR=i>>>4&1,this.OPCR=i>>>3&1,this.splicePoint=i>>>2&1,this.transportPrivate=i>>>1&1,this.adaptationField=1&i;var a=e.position;if(1===this.PCR&&(this.programClockBase=e.readUint32()<<1,i=e.readUint16(),this.programClockBase|=i>>>15,this.programClockExtension=511&i),1===this.OPCR&&(this.originProgramClockBase=e.readUint32()<<1,i=e.readUint16(),this.originProgramClockBase+=i>>>15,this.originProgramClockExtension=511&i),1===this.splicePoint&&(this.spliceCountdown=e.readUint8()),1===this.transportPrivate)for(var s=e.readUint8(),u=[],o=0;s>o;o++)u.push(e.readUint8());if(1===this.adaptationField){var d=e.readUint8(),l=e.readUint8(),c=e.position,h=l>>>7,p=l>>>6&1,v=l>>>5&1;1===h&&(l=e.readUint16(),this.ltwValid=l>>>15,this.ltwOffset=61439&l),1===p&&(l=e.readUint24(),this.piecewiseRate=4194303&l),1===v&&(l=e.readInt8(),this.spliceType=l>>>4,this.dtsNextAU1=l>>>1&7,this.marker1=1&l,l=e.readUint16(),this.dtsNextAU2=l>>>1,this.marker2=1&l,l=e.readUint16(),this.dtsNextAU3=l),e.skip(d-1-(e.position-c))}var m=this.adaptationLength-1-(e.position-a);e.skip(m)}this.buffer=new f["default"](e.buffer.slice(e.position))}},{key:"PES",value:function(t){var n=t[0],r=n.body.buffer,i=r.readUint24();if(this.header=n.header,1!==i)throw new Error("this is not pes packet");var a=r.readUint8();a>=224&&239>=a&&(this.type="video"),a>=192&&223>=a&&(this.type="audio");var s=r.readUint16();if(this.packetLength=s,"video"!==this.type&&"audio"!==this.type)throw new Error("format is not supported");var u=r.readUint8(),o=u>>>6;if(2!==o)throw new Error("error when parse pes header");u=r.readUint8(),this.ptsDTSFlag=u>>>6,this.escrFlag=u>>>5&1,this.esRateFlag=u>>>4&1,this.dsmFlag=u>>>3&1,this.additionalFlag=u>>>2&1,this.crcFlag=u>>>1&1,this.extensionFlag=1&u,this.pesHeaderLength=r.readUint8();var f=this.pesHeaderLength;if(2===this.ptsDTSFlag){var d=[];u=r.readUint8(),d.push(u>>>1&7),u=r.readUint16(),d.push(u>>>1),u=r.readUint16(),d.push(u>>>1),this.pts=d[0]<<30|d[1]<<15|d[2],f-=5,"video"===this.type&&(this.dts=this.pts)}if(3===this.ptsDTSFlag){var l=[];u=r.readUint8(),l.push(u>>>1&7),u=r.readUint16(),l.push(u>>>1),u=r.readUint16(),l.push(u>>>1),this.pts=l[0]<<30|l[1]<<15|l[2];var c=[];u=r.readUint8(),c.push(u>>>1&7),u=r.readUint16(),c.push(u>>>1),u=r.readUint16(),c.push(u>>>1),this.dts=c[0]<<30|c[1]<<15|c[2],f-=10}if(1===this.escrFlag){var h=[],p=[];u=r.readUint8(),h.push(u>>>3&7),h.push(3&u),u=r.readUint16(),h.push(u>>>13),h.push(3&u),u=r.readUint16(),h.push(u>>>13),p.push(3&u),u=r.readUint8(),p.push(u>>>1),this.escr=300*(h[0]<<30|h[1]<<28|h[2]<<15|h[3]<<13|h[4])+(p[0]<<7|p[1]),f-=6}if(1===this.esRateFlag&&(u=r.readUint24(),this.esRate=u>>>1&4194303,f-=3),1===this.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===this.additionalFlag&&(u=r.readUint8(),this.additionalCopyInfo=127&u,f-=1),1===this.crcFlag&&(this.pesCRC=r.readUint16(),f-=2),1===this.extensionFlag)throw new Error("not support extension");f>0&&r.skip(f),this.ES=new e.ES(r,this.type,t.slice(1))}},{key:"ES",value:function(t,n,r){var i=void 0;if("video"===n){if(i=t.readUint32(),1!==i&&(t.back(4),i=t.readUint24(),1!==i))throw new Error("h264 nal header parse failed");t.skip(2),this.sps=h(t),this.pps=p(t);var a=void 0;if(this.sps.length?(this.info=new l["default"](new Uint8Array(this.sps)).readSPS(),a=t.readUint24()):(a=t.readUint24(),0===a&&(a=t.readUint8())),1!==a)throw new Error("h264 convert to avcc error");var s=e.Merge(t,r);this.buffer=(0,u["default"])(Uint8Array,t.writeUint32(s.byteLength),s)}else{if("audio"!==n)throw"ES "+n+" is not supported";if(i=t.readUint16(),i>>>4!==4095)throw new Error("aac ES parse Error");var o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];this.id=0===(i>>>3&1)?"MPEG-4":"MPEG-2",this.layer=i>>>1&3,this.absent=1&i,i=t.readUint16(),this.audioObjectType=(i>>>14&3)+1,this.profile=this.audioObjectType-1,this.frequencyIndex=i>>>10&15,this.frequence=o[this.frequencyIndex],this.channel=i>>>6&7,this.frameLength=(3&i)<<11|t.readUint16()>>>5,this.audioConfig=e.getAudioConfig(this.audioObjectType,this.channel,this.frequencyIndex),t.skip(1),this.buffer=e.Merge(t,r)}}},{key:"TSDT",value:function(){return{}}},{key:"CAT",value:function(e,t){this.tableID=e.readUint8();var n=e.readUint16();this.sectionIndicator=n>>>7,this.sectionLength=4095&n,e.skip(2),n=e.readUint8(),this.version=n>>>3,this.currentNextIndicator=1&n,this.sectionNumber=e.readUint8(),this.lastSectionNumber=e.readUint8();for(var r=(this.sectionLength-9)/4,i=[],a=0;r>a;a++)i.push({});this.crc32=e.readUint32()}},{key:"Merge",value:function(e,t){var n=e.length-e.position,r=void 0,i=n;return t.forEach(function(e){n+=e.body.buffer.length}),r=new Uint8Array(n),r.set(new Uint8Array(e.buffer,e.position),0),t.forEach(function(t){e=t.body.buffer,r.set(new Uint8Array(e.buffer,e.position),i),i+=e.length-e.position}),r}},{key:"getAudioConfig",value:function(e,t,n){var r=navigator.userAgent.toLowerCase(),i=void 0,a=void 0;return/firefox/i.test(r)?n>=6?(e=5,i=new Array(4),a=n-3):(e=2,i=new Array(2),a=n):-1!==r.indexOf("android")?(e=2,i=new Array(2),a=n):(e=5,i=new Array(4),n>=6?a=n-3:(1===t&&(e=2,i=new Array(2)),a=n)),i[0]=e<<3,i[0]|=(14&n)>>1,i[1]=(1&n)<<7,i[1]|=t<<3,5===e&&(i[1]|=(14&a)>>1,i[2]=(1&a)<<7,i[2]|=8,i[3]=0),i}}]),e}();v.PATSpace=[],t["default"]=v,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,function(e){t.setAttribute(e.name,e.value)}),t}return""}function f(e,t,n){var r=t.split(".").pop();return/^mp4/.test(r)?new T(e,t,n):/^m3u8/.test(r)?new S(e,t,n):void 0}Object.defineProperty(t,"__esModule",{value:!0});var d=function B(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:B(i,t,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(11),h=r(c),p=n(34),v=r(p),m=n(81),y=r(m),g=n(6),w=r(g),b=n(2),k=r(b),U=n(82),_=r(U),E=n(7),x=r(E),T=function(){function e(t,n,r){var i=this;u(this,e),this.url=n,this.id=r,this.mediaElement=t,(0,k["default"])(this),this.init().then(function(){i.ev=["play","playing","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata"].map(function(e){return s({},e,"on"+e.charAt(0).toUpperCase()+e.slice(1))}),i._interval={};var e="0,0";i.ev.forEach(function(t){var n=i,r=Object.keys(t)[0];i.mediaElement.addEventListener(r,function(){"play"===r&&(n.hasStart=!0),"error"===r?n.mediaElement.error&&n.emit(r,new x["default"]("other",n.mediaElement.currentTime,n.mediaElement.duration,n.mediaElement.networkState,n.mediaElement.readyState,n.mediaElement.currentSrc,n.mediaElement.src,n.ended,{line:41,msg:n.error,handle:"Constructor"})):n.emit(r,n),n.hasOwnProperty("_interval")&&(["ended","error","timeupdate"].indexOf(r)<0?_["default"].setInterval(n,"bufferedChange",function(){for(var t=[],r=0,i=n.mediaElement.buffered.length;i>r;r++)t.push([n.mediaElement.buffered.start(r),n.mediaElement.buffered.end(r)]);t.toString()!==e&&(e=t.toString(),n.emit("bufferedChange",t))},200):"timeupdate"!==r&&_["default"].clearInterval(n,"bufferedChange"))},!1)}),i.preloadTime=15,i.attchEvent(),i.id=r,i.cache={}})}return l(e,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.mse=new y["default"],this.mediaElement.src=this.mse.url,[4,Promise.all([this.load(this.url,this.id),this.mse.init()])];case 1:return e=t.sent(),this.player=e[0].mp4,[4,this.mse.appendBuffer(this.player.packMeta())];case 2:return t.sent(),this.mse.duration=this.player.meta.duration,this.loadData(0,0),[2]}})})}},{key:"loadData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.mediaElement.currentTime;this.timer&&clearTimeout(this.timer),n=Math.max(n,this.mediaElement.currentTime),this.timer=setTimeout(function(){e.player.seek(n+.1*t).then(function(t){if(t){var n=e.mse;n.appendBuffer(t)}},function(){10>t&&setTimeout(function(){e.loadData(t+1)},2e3)})},50)}},{key:"isEnded",value:function(){if(this.duration&&this.duration-this.mediaElement.currentTime<2){var e=this.getBufferedRange();return this.duration-e[1]<.2&&this.mse.endOfStream(),this.duration-this.mediaElement.currentTime<.2?(this.emit("ended"),!0):!1}return!1}},{key:"steamEnd",value:function(){this.mse.endOfStream()}},{key:"getBufferedRange",value:function(){var e=[0,0],t=this.mediaElement.buffered,n=this.mediaElement.currentTime;if(t)for(var r=0,i=t.length;i>r&&(e[0]=t.start(r),e[1]=t.end(r),!(e[0]<=n&&n<=e[1]));r++);return e[0]-n<=0&&n-e[1]<=0?e:[0,0]}},{key:"attchEvent",value:function(){this.on("timeupdate",this.timeupdate),this.on("seeking",this.seeking),this.on("pause",this.pause),this.on("playing",this.playing),this.on("waiting",this.waiting),this.once("destroy",this.destroy)}},{key:"removeEvent",value:function(){this.off("timeupdate",this.timeupdate),this.off("seeking",this.seeking),this.off("pause",this.pause),this.off("playing",this.playing),this.off("waiting",this.waiting)}},{key:"timeupdate",value:function(){var e=this,t=this.mse,n=this.player;if(t&&!t.updating&&n.canDownload){var r=n.timeRage,i=this.getBufferedRange(),a=this.mediaElement.currentTime+this.preloadTime;if(i[1]-a>0)return;r.every(function(t,r){var a=t[0],s=t[1],u=(a+s)/2;return 0===i[1]?(e.loadData(5),!1):u>i[1]&&!n.bufferCache.has(r)?void e.loadData(0,u):!0}),this.isEnded()}}},{key:"seeking",value:function(){var e=this.mediaElement.buffered,t=!1,n=this.mediaElement.currentTime;if(w["default"].clear(),e.length){for(var r=0,i=e.length;i>r;r++)if(n>=e.start(r)&&n<=e.end(r)){t=!0;break}t||this.loadData(0,n)}else this.loadData(0,this.mediaElement.currentTime)}},{key:"pause",value:function(){w["default"].clear()}},{key:"playing",value:function(){this.waiterTimer&&clearTimeout(this.waiterTimer)}},{key:"waiting",value:function(){var e=this.player;if(e&&e.meta){var t=(this.getBufferedRange(),e.meta.videoDuration);t-this.mediaElement.currentTime<.2?this.isEnded():this.player.seek()}}},{key:"destroy",value:function(){var e=this.mediaElement.parentNode;w["default"].clear(),this.timer&&clearTimeout(this.timer),this.removeEvent(),this.mse.endOfStream(),this.clear(),this.mse=void 0,this.player=void 0;for(var t in this._interval)clearInterval(this._interval[t]),this._interval[t]=null;this.mediaElement.paused||(this.pause(),this.mediaElement.src="");var n=o(this.mediaElement);this.mediaElement.id=this.mediaElement.id+"_del",e.insertBefore(n,this.mediaElement),e.removeChild(this.mediaElement)}},{key:"load",value:function(e,t){return new Promise(function(n){var r=new v["default"](e);r.on("moovReady",function(){n({id:t,mp4:r,url:e})})})}},{key:"preload",value:function(e){var t=this,n=[];e.forEach(function(e){t.cache[e.id]={status:"downloading"},n.push(t.load(e.url,e.id))}),Promise.all(n).then(function(e){e.forEach(function(e){var n=e.id;t.cache[n]={mp4:e.mp4,status:"done",url:e.url}})})}},{key:"switch",value:function(e,t){var n=this;return new Promise(function(r){return __awaiter(this,void 0,void 0,function(){var i,a;return __generator(this,function(s){switch(s.label){case 0:return n.cache[e]&&"done"===n.cache[e].status?(i=n.cache[e].mp4,n.clear("-"+n.id),n.mse.reset(),[4,n.mse.endOfStream()]):[3,2];case 1:return s.sent(),a=n.getBufferedRange()[1],a>0&&n.mse.removeBuffer(0,a),n.player.clear(),n.player=i,n.mse.appendBuffer(i.packMeta()).then(function(){n.mse.duration=i.meta.duration,n.mediaElement.currentTime=0,n.loadData(0,0),n.id=e,r(!0)}),[3,3];case 2:n.cache[e]&&"downloading"===n.cache[e].status?setTimeout(function(){n["switch"](e).then(function(){r(!0)})},50):n.load(t,e).then(function(t){n.cache[e]={},n.cache[e].status="done",n.cache[e].mp4=t.mp4,n["switch"](e),r(!0)}),s.label=3;case 3:return[2]}})})})}},{key:"clear",value:function(e){var t=this;e?0===e.indexOf("-")?(e=e.slice(1,e.length),Object.keys(this.cache).forEach(function(n){n!==e&&t.cache[n]&&(t.cache[n].url&&w["default"].clear(t.cache[n].url),t.cache[n]=void 0)})):this.cache[e]&&(this.cache[e].url&&w["default"].clear(this.cache[e].url),this.cache[e]=void 0):(Object.keys(this.cache).forEach(function(e){t.cache[e]&&(t.cache[e].url&&w["default"].clear(t.cache[e].url),t.cache[e]=void 0)}),this.cache={})}},{key:"duration",get:function(){return this.player&&this.player.meta?this.player.meta.duration:0/0}}]),e}(),S=function(e){function t(e,n){u(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.type="m3u8",r}return a(t,e),l(t,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=new y["default"]('video/mp4; codecs="avc1.4d4029, mp4a.40.2"'),t=new h["default"](this.url,e),this.mediaElement.src=e.url,[4,Promise.all([e.init(),t.init()])];case 1:return n.sent(),clearTimeout(t.m3u8.timer),this.player=t,this.mse=e,[4,Promise.all([this.loadData(0),this.loadData(2)])];case 2:return n.sent(),[2]}})})}},{key:"clear",value:function(e){var t=this;e?0===e.indexOf("-")?(e=e.slice(1,e.length),Object.keys(this.cache).forEach(function(n){n!==e&&t.cache[n]&&(t.cache[n]=void 0)})):this.cache[e]&&(this.cache[e]=void 0):(Object.keys(this.cache).forEach(function(e){t.cache[e]&&(t.cache[e]=void 0)}),this.cache={})}},{key:"preload",value:function(e){var t=this,n=[];e.forEach(function(e){t.cache[e.id]={status:"downloading"},n.push(t.load(e.url,e.id))}),Promise.all(n).then(function(e){e.forEach(function(e){var n=e.id;t.cache[n]={hls:e.hls,status:"done",url:e.url}})})}},{key:"isEnded",value:function(){if(this.duration&&this.duration-this.mediaElement.currentTime<2){var e=this.getBufferedRange();
return this.duration-e[1]<.3&&this.mse.endOfStream(),this.duration-this.mediaElement.currentTime<.3?(this.emit("ended"),!0):!1}return!1}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.mediaElement.currentTime,t=this.getBufferedRange();return e<t[1]?"vod"===this.player.type&&t[1]-e<this.preloadTime?this.player.seek(t[1]+1):void 0:this.player.seek(e)}},{key:"load",value:function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return n=new h["default"](e,this.mse),[4,n.init()];case 1:return r.sent(),[2,{id:t,url:e,hls:n}]}})})}},{key:"switch",value:function(e,t){var n=this;return new Promise(function(r){return __awaiter(this,void 0,void 0,function(){var i,a,s;return __generator(this,function(u){switch(u.label){case 0:return n.cache[e]&&"done"===n.cache[e].status?(console.log("preload succ"),i=n.cache[e].hls,n.clear("-"+n.id),n.mse.reset(),[4,n.mse.abort()]):[3,6];case 1:return u.sent(),[4,n.mse.endOfStream()];case 2:return u.sent(),a=n.getBufferedRange()[1],s=a>0,s?[4,n.mse.removeBuffer(0,a)]:[3,4];case 3:s=u.sent(),u.label=4;case 4:return n.player.clear(),n.player=i,n.id=e,[4,n.player.seek(0)];case 5:return u.sent(),n.mediaElement.currentTime=0,r(!0),[3,7];case 6:n.cache[e]&&"downloading"===n.cache[e].status?(console.log("downloading---->"),setTimeout(function(){n["switch"](e).then(function(){r(!0)})},50)):(console.log("no preload----->"),n.load(t,e).then(function(t){n.cache[e]={},n.cache[e].status="done",n.cache[e].hls=t.hls,n["switch"](e),r(!0)})),u.label=7;case 7:return[2]}})})})}},{key:"timeupdate",value:function(){var e=this.isEnded();!e&&this.loadData(this.mediaElement.currentTime+2>this.duration?this.duration:this.mediaElement.currentTime+2)}},{key:"seeking",value:function(){this.loadData()}},{key:"pause",value:function(){}},{key:"waiting",value:function(){if("live"===this.player.type){for(var e=this.media.buffered,t=e.length,n=this.mediaElement.currentTime,r=0;t>r;r++)if(e.start(r)>n){this.mediaElement.currentTime=e.start(r)+.1;break}}else this.loadData()}},{key:"destroy",value:function(){clearTimeout(this.player.m3u8.timer),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"duration",get:function(){return this.player&&this.player.meta?this.player.meta.duration:0/0}}]),t}(T);window.MsePlayer=f,t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),u=r(s),o=n(27),f=r(o),d=n(29),l=r(d),c=n(9),h=r(c),p=n(3),v=r(p),m=n(33),y=r(m),g=n(6),w=r(g),b=function(){function e(t,n){i(this,e),(0,u["default"])(this),this.mse=n,this.url=t,this.inited=!1,this.cache=new v["default"]}return a(e,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this,this.m3u8=new f["default"](this.url),[4,this.m3u8.init()];case 1:return t.sent(),this.type=this.m3u8.type,"live"===this.type&&(this.seeker&&clearInterval(hls.seeker),this.once("end",function(){e.seeker&&clearInterval(e.seeker)}),this.seek(),this.seeker=setInterval(function(){this.seek()},2e3)),[2]}})})}},{key:"seek",value:function(e){var t=this;return new Promise(function(n){var r=t.m3u8.seek(e);if(r.length&&!r[0].downloaded){new w["default"](r[0].url,function(e){var i=new l["default"](e);t.parse(i);var a=r[0].url;t.m3u8.segments.every(function(e){return e.url!==a?!0:(e.downloaded=!0,!1)}),n(!0)})}else n(!0)})}},{key:"parse",value:function(e,t){var n=[],r=[],i=[],a=this;e.pes.forEach(function(e){var t=new h["default"].PES(e);n.push(t),"video"===t.type&&r.push(t),"audio"===t.type&&i.push(t)}),r.some(function(e){if(e.ES.sps.length){var t=e.ES,n=i[0].ES,r=0;return a.m3u8.segments.forEach(function(e){r+=1*e.duration}),a.meta={sps:t.sps,pps:t.pps,width:t.info.width,height:t.info.height,pixelRatio:t.info.pixelRatio,channelCount:n.channel,timescale:n.frequence,samplerate:n.frequence,profile:n.profile,duration:r,audioConfig:i[0].ES.audioConfig},!1}}),a.videoSamples=r,a.audioSamples=i,a.meta?(void 0===a.startDTS&&(a.startDTS=Math.min(r[0].dts,i[0].pts)),a.initSegment(a.meta)):a.seek()}},{key:"initSegment",value:function(e){if(!this.inited){var t=new v["default"];t.write(y["default"].ftyp()),t.write(y["default"].moov(e)),this.mse.appendBuffer(t.buffer),this.inited=!0,this.cache.write(t.buffer)}this.createVideoFragment(),this.createAudioFragment()}},{key:"addFragment",value:function(e){var t=this,n=new v["default"];n.write(y["default"].moof(e)),n.write(y["default"].mdat(e)),this.mse.appendBuffer(n.buffer).then(function(){t.update()}),this.cache.write(n.buffer)}},{key:"createVideoFragment",value:function(){var e=this.videoSamples,t=e.length,n=(e[t-1].dts-e[0].dts)/t,r=void 0,i=void 0;i=this.startDTS,r=e.map(function(r,i){var a=void 0;return a=i+1===t?n:e[i+1].dts-r.dts,{size:r.ES.buffer.byteLength,duration:a,offset:r.pts-r.dts,buffer:r.ES.buffer,key:!!r.ES.pps.length}}),this.addFragment({id:1,time:e[0].dts-i,firstFlags:33554432,flags:3841,samples:r})}},{key:"createAudioFragment",value:function(){var e=this.audioSamples,t=e.length,n=this.startDTS||0,r=void 0,i=void 0;r=e.map(function(n,r){return i=r+1===t?(e[t-1].pts-e[0].pts)/t:e[r+1].pts-n.pts,{size:n.ES.buffer.byteLength,duration:i,offset:0,buffer:n.ES.buffer,key:!0}}),this.addFragment({id:2,time:e[0].pts-n,firstFlags:0,flags:1793,samples:r})}},{key:"reset",value:function(){this.init(this.url)}},{key:"clear",value:function(){this.cache=new v["default"]}},{key:"update",value:function(){for(var e=this.mse.sourceBuffer,t=this.m3u8.segments,n=e.buffered,r=void 0,i=void 0,a=0,s=n.length;s>a;a++){r=n.start(a),i=n.end(a);for(var u,o=0,f=t.length;f>o;o++)u=t[a],u.start>=r&&u.end<=i&&(u.downloaded=!0)}}}]),e}();t["default"]=b,e.exports=t["default"]},function(e,t,n){"use strict";var r,i=n(13),a=n(21),s=n(22),u=n(23);r=e.exports=function(e,t){var n,r,s,o,f;return arguments.length<2||"string"!=typeof e?(o=t,t=e,e=null):o=arguments[2],null==e?(n=s=!0,r=!1):(n=u.call(e,"c"),r=u.call(e,"e"),s=u.call(e,"w")),f={value:t,configurable:n,enumerable:r,writable:s},o?i(a(o),f):f},r.gs=function(e,t,n){var r,o,f,d;return"string"!=typeof e?(f=n,n=t,t=e,e=null):f=arguments[3],null==t?t=void 0:s(t)?null==n?n=void 0:s(n)||(f=n,n=void 0):(f=t,t=n=void 0),null==e?(r=!0,o=!1):(r=u.call(e,"c"),o=u.call(e,"e")),d={get:t,set:n,configurable:r,enumerable:o},f?i(a(f),d):d}},function(e,t,n){"use strict";e.exports=n(14)()?Object.assign:n(15)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"!=typeof t?!1:(e={foo:"raz"},t(e,{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(16),i=n(20),a=Math.max;e.exports=function(e,t){var n,s,u,o=a(arguments.length,2);for(e=Object(i(e)),u=function(r){try{e[r]=t[r]}catch(i){n||(n=i)}},s=1;o>s;++s)t=arguments[s],r(t).forEach(u);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(17)()?Object.keys:n(18)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(4),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(4);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var r=n(4),i=Array.prototype.forEach,a=Object.create,s=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=a(null);return i.call(arguments,function(e){r(e)&&s(Object(e),t)}),t}},function(e,t,n){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,n){"use strict";e.exports=n(24)()?String.prototype.contains:n(25)},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"!=typeof r.contains?!1:r.contains("dwa")===!0&&r.contains("foo")===!1}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),u=r(s),o=n(28),f=r(o),d=function(){function e(t){i(this,e),this.url=t,this.segments=[],this.retryMax=10,this.retry=0,this.type="live",this.isEnd=!1,this.timer=null,this.rangeDuration=2e3,this.duration=0,(0,u["default"])(this)}return a(e,[{key:"fetch",value:function(t){var n={TYPE:"LIVE",ENDLIST:""},r=[];return new Promise(function(i,a){new f["default"]({type:"",url:t}).then(function(s){var u=s.responseText;if(u){var o=u.substring(0,u.indexOf("#EXTINF")),f=u.substring(u.lastIndexOf("#EXTINF")),d=e.Tag,l=new RegExp(d.EXTINF.source);Object.keys(d).forEach(function(e){"EXTINF"!==e&&(d[e].test(o)||d[e].test(f))&&(n[e]=RegExp.$2?[RegExp.$1,RegExp.$2]:RegExp.$1||!0)}),u.match(d.EXTINF).forEach(function(n,i){if(l.test(n)){var a=1*RegExp.$1,s=RegExp.$2,u=e.resolve(t,s);r.push({idx:i,duration:a,title:s,downloaded:!1,url:u})}}),1*n.SEQUENCE===0&&n.ENDLIST&&(n.TYPE="VOD"),i({meta:n,segments:r})}else a(new Error("parse error"))})["catch"](function(e){a(e)})})}},{key:"init",value:function(){var e=this;return new Promise(function(t){var n=e,r=n.segments;e.fetch(e.url).then(function(e){n.type=e.meta.TYPE.toLocaleLowerCase(),n.isEnd=e.meta.ENDLIST,e.segments.forEach(function(e){r.push(e)}),n.emit("ready"),t("true")},function(){r.length=0,n.retry++,n.retry<n.retryMax&&n.init(n.url).then(function(){t(!0)})})})}},{key:"seek",value:function(e){var t=this.segments,n=void 0;if("vod"===this.type||void 0!==e){if(void 0===t[0].start)for(var r,i=0,a=0,s=t.length;s>a;a++)r=t[a],r.start=i,i+=r.duration,r.end=i;n=t.filter(function(t){return t.start<=e&&e<t.end&&!t.downloaded})}else n=t.filter(function(e){return!e.downloaded}),"live"===this.type&&t.filter(function(e){return!e.downloaded}).length<3&&this.update(1);return n}},{key:"reset",value:function(){this.segments.length=0,this.isEnd=!1,this.type="live",this.timer&&(clearInterval(this.timer),this.timer=null),this.init(this.url)}},{key:"update",value:function(e){var t=this,n=t.url,r=t.segments;t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){var e=0;t.fetch(n).then(function(n){n.segments.forEach(function(t){r.some(function(e){return t.url===e.url})||(e++,r.push(t))}),0>=e&&t.update()},function(){t.retry++,t.retry<t.retryMax?t.update():t.emit("end")})},e?0:t.rangeDuration)}}],[{key:"resolve",value:function(e,t){var n=[],r=document.createElement("a");r.href=e;var i=t,a=r.pathname.replace(/^\/+/,"").split("/"),s=i.split("/");a.pop();var u=function o(){switch(s[0]){case"":n=s.slice(1);break;case".":n=a.concat(s.slice(1));break;case"..":if(s.shift(),!a.length)throw new Error("path in invalid");a.pop(),o();break;default:n=a.concat(s)}};return u(),n=n.length?r.protocol+"//"+r.host+"/"+n.join("/"):i.href}}]),e}();d.Tag={EXTM3U:/^#EXTM3U/,TYPE:/#EXT-X-PLAYLIST-TYPE:(\w+)/,EXTINF:/#EXTINF:(\d+\.?\d*)(?:,(?:[^\r|\n]*)(?:\r|\n)*)(.*(?!#))/g,DURATION:/#EXT-X-TARGETDURATION:(\d+\.?\d*)/,SEQUENCE:/#EXT-X-MEDIA-SEQUENCE:(\d+)/,ENDLIST:/#EXT-X-ENDLIST/,VERSION:/#EXT-X-VERSION:(\d+)/,STREAM:/#EXT-X-STREAM-INF:(\w+=\w+)+/},t["default"]=d,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,n=e.method,i=void 0===n?"GET":n,s=e.type,u=void 0===s?"arraybuffer":s,o=e.data,f=void 0===o?{}:o;return r(this,a),new Promise(function(e,n){var r=new window.XMLHttpRequest,a=i.toUpperCase(),s=[];u&&(r.responseType=u);for(var o in f)s.push("k="+f[o]);if("GET"===a)r.open(a,t+"?"+s.join("&")),r.send();else{if("post"!==a)throw new Error("xhr "+a+" is not supported");r.open(a,t),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(s.join("&"))}r.onload=function(){200===r.status||206===r.status?e(r):n(r)},r.onerror=function(){n(r)}})};t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(9),u=r(s),o=function(){function e(t){i(this,e),this.buffer=t,this.ts=[];for(var n=0,r=this.buffer.byteLength;r>n;)this.ts.push(new u["default"](this.buffer.slice(n,n+188),n/188)),n+=188;delete this.buffer}return a(e,[{key:"pat",get:function(){return this.ts.filter(function(e){return 0===e.header.pid})}},{key:"pmt",get:function(){var e=this.pat,t=[];return e.forEach(function(e){e.body.list.filter(function(e){t.push(e.pid)})}),this.ts.filter(function(e){return t.some(function(t){return t===e.header.pid})})}},{key:"pes",get:function(){var e=this.pmt,t=[],n=[];e.forEach(function(e){t=t.concat(e.body.list.map(function(e){return e.pid}))});for(var r=this.ts,i=r.length,a=void 0,s=[],u=[],o=0;i>o;o++)a=r[o],t.indexOf(a.header.pid)>-1&&("video"===a.body.type?1===a.header.payload?(s=[],s.push(a),n.push(s)):0===s.length?n.push([a]):s.push(a):"audio"===a.body.type&&(1===a.header.payload?(u=[],u.push(a),n.push(u)):0===u.length?n.push([a]):u.push(a)));return n}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){for(var t=0,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var a=!0,s=!1,u=void 0;try{for(var o,f=r[Symbol.iterator]();!(a=(o=f.next()).done);a=!0){var d=o.value;t+=d.length}}catch(l){s=!0,u=l}finally{try{!a&&f["return"]&&f["return"]()}finally{if(s)throw u}}var c=new e(t),h=0,p=!0,v=!1,m=void 0;try{for(var y,g=r[Symbol.iterator]();!(p=(y=g.next()).done);p=!0){var w=y.value;c.set(w,h),h+=w.length}}catch(l){v=!0,m=l}finally{try{!p&&g["return"]&&g["return"]()}finally{if(v)throw m}}return c}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){if(r(this,e),!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return i(e,[{key:"back",value:function(e){this.position-=e}},{key:"skip",value:function(t){for(var n=Math.floor(t/4),r=t%4,i=0;n>i;i++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var r=void 0;switch(t){case 1:r=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw"not supported for readByte 3";r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw"not supported for readBody 8";r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&window.console.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,n,r=8,i=8;for(t=0;e>t;t++)0!==i&&(n=this.readEG(),i=(r+n+256)%256),r=0===i?r:i}},{key:"readSPS",value:function(){var e,t,n,r,i,a,s,u,o,f=0,d=0,l=0,c=0,h=this.readUByte.bind(this),p=this.readBits.bind(this),v=this.readUEG.bind(this),m=this.readBoolean.bind(this),y=this.skipBits.bind(this),g=this.skipEG.bind(this),w=this.skipUEG.bind(this),b=this.skipScalingList.bind(this);if(h(),e=h(),t=p(5),y(3),n=h(),w(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var k=v();if(3===k&&y(1),w(),w(),y(1),m())for(u=3!==k?8:12,o=0;u>o;o++)m()&&b(6>o?16:64)}w();var U=v();if(0===U)v();else if(1===U)for(y(1),g(),g(),r=v(),o=0;r>o;o++)g();w(),y(1),i=v(),a=v(),s=p(1),0===s&&y(1),y(1),m()&&(f=v(),d=v(),l=v(),c=v());var _=[1,1];if(m()&&m()){var E=h();switch(E){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:_=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil(16*(i+1)-2*f-2*d),height:(2-s)*(a+1)*16-(s?2:4)*(l+c),pixelRatio:_}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),u=r(s),o=Math.pow(2,32)-1,f=function(){function e(){i(this,e)}return a(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return u["default"].writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new u["default"];return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var n=new u["default"],r=8,i=e.mvhd(t.duration),a=e.videoTrak(t),s=e.audioTrak(t),o=e.mvex(t.duration);return[i,a,s,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moov"),i,a,s,o),n.buffer}},{key:"mvhd",value:function(t){var n=new u["default"],r=9e4;t*=r;var i=Math.floor(t/(o+1)),a=Math.floor(t%(o+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n.write(e.size(8+s.length),e.type("mvhd"),new Uint8Array(s)),n.buffer}},{key:"videoTrak",value:function(t){var n=new u["default"],r=8,i=e.tkhd({id:1,duration:t.duration,timescale:9e4,width:t.width,height:t.height,type:"video"}),a=e.mdia({type:"video",timescale:9e4,duration:t.duration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,a),n.buffer}},{key:"audioTrak",value:function(t){var n=new u["default"],r=8,i=e.tkhd({id:2,duration:t.duration,timescale:9e4,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timescale:9e4,duration:t.duration,channelCount:t.channelCount,samplerate:t.samplerate,audioConfig:t.audioConfig});return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,a),n.buffer}},{key:"tkhd",value:function(t){var n=new u["default"],r=t.id,i=t.duration*t.timescale,a=t.width,s=t.height,f=t.type,d=Math.floor(i/(o+1)),l=Math.floor(i%(o+1)),c=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,"video"===f?1:0,"audio"===f?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]);return n.write(e.size(8+c.byteLength),e.type("tkhd"),c),n.buffer}},{key:"edts",value:function(t){var n=new u["default"],r=t.duration,i=t.mediaTime;return n.write(e.size(36),e.type("edts")),n.write(e.size(28),e.type("elst")),n.write(new Uint8Array([0,0,0,1,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,1])),n.buffer}},{key:"mdia",value:function(t){var n=new u["default"],r=8,i=e.mdhd(t.timescale),a=e.hdlr(t.type),s=e.minf(t);return[i,a,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("mdia"),i,a,s),n.buffer}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new u["default"];n*=t;var i=Math.floor(n/(o+1)),a=Math.floor(n%(o+1)),s=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]);return r.write(e.size(12+s.byteLength),e.type("mdhd"),e.extension(1,0),s),r.buffer}},{key:"hdlr",value:function(t){var n=new u["default"],r=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(r.splice.apply(r,[8,4].concat([115,111,117,110])),r.splice.apply(r,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),n.write(e.size(8+r.length),e.type("hdlr"),new Uint8Array(r)),n.buffer}},{key:"minf",value:function(t){var n=new u["default"],r=8,i="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),s=e.stbl(t);return[i,a,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("minf"),i,a,s),n.buffer}},{key:"vmhd",value:function(){var t=new u["default"];return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new u["default"];return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new u["default"],n=[0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1];return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array(n)),t.buffer}},{key:"stbl",value:function(t){var n=new u["default"],r=8,i=e.stsd(t),a=e.stts(),s=e.stsc(),o=e.stsz(),f=e.stco();return[i,a,s,o,f].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("stbl"),i,a,s,o,f),n.buffer}},{key:"stsd",value:function(t){var n=new u["default"],r=void 0;return r="audio"===t.type?e.mp4a(t):e.avc1(t),n.write(e.size(16+r.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),r),n.buffer}},{key:"mp4a",value:function(t){var n=new u["default"],r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=e.esds(t.audioConfig);return n.write(e.size(8+r.byteLength+i.byteLength),e.type("mp4a"),r,i),n.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],n=t.length,r=new u["default"],i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(t).concat([6,1,2]));return r.write(e.size(8+i.byteLength),e.type("esds"),i),r.buffer}},{key:"avc1",value:function t(n){var r=new u["default"],i=40,a=n.sps,s=n.pps,o=n.width,f=n.height,d=n.pixelRatio[0],l=n.pixelRatio[1],c=new Uint8Array([1,a[1],a[2],a[3],255,225].concat([a.length>>>8&255,255&a.length]).concat(a).concat(1).concat([s.length>>>8&255,255&s.length]).concat(s)),t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,f>>8&255,255&f,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),p=new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l]);return r.write(e.size(i+t.byteLength+c.byteLength+h.byteLength),e.type("avc1"),t,e.size(8+c.byteLength),e.type("avcC"),c,e.size(20),e.type("btrt"),h,e.size(16),e.type("pasp"),p),r.buffer}},{key:"stts",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),n),t.buffer}},{key:"stsc",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),n),t.buffer}},{key:"stco",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),n),t.buffer}},{key:"stsz",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),n),t.buffer}},{key:"mvex",value:function(t){var n=new u["default"],r=u["default"].writeUint32(9e4*t);return n.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),r,e.trex(1),e.trex(2)),n.buffer}},{key:"trex",value:function(t){var n=new u["default"],r=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.write(e.size(8+r.byteLength),e.type("trex"),r),n.buffer}},{key:"moof",value:function(t){var n=new u["default"],r=8,i=e.mfhd(),a=e.traf(t);return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moof"),i,a),n.buffer}},{key:"mfhd",value:function(){var t=new u["default"],n=u["default"].writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),n),t.buffer}},{key:"traf",value:function(t){var n=new u["default"],r=8,i=e.tfhd(t.id),a=e.tfdt(t.time),s=e.sdtp(t),o=e.trun(t,s.byteLength);return[i,a,s,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("traf"),i,a,s,o),n.buffer}},{key:"tfhd",value:function(t){var n=new u["default"],r=u["default"].writeUint32(t);return n.write(e.size(16),e.type("tfhd"),e.extension(0,0),r),n.buffer}},{key:"tfdt",value:function(t){var n=new u["default"],r=Math.floor(t/(o+1)),i=Math.floor(t%(o+1));return n.write(e.size(20),e.type("tfdt"),e.extension(1,0),u["default"].writeUint32(r),u["default"].writeUint32(i)),n.buffer}},{key:"trun",value:function(t,n){var r=t.id,i=1===r?16:12,a=new u["default"],s=u["default"].writeUint32(t.samples.length),o=u["default"].writeUint32(96+i*t.samples.length+n);return a.write(e.size(20+i*t.samples.length),e.type("trun"),e.extension(0,t.flags),s,o),t.samples.forEach(function(e,t){a.write(u["default"].writeUint32(e.duration)),a.write(u["default"].writeUint32(e.size)),1===r?(a.write(u["default"].writeUint32(e.key?33554432:16842752)),a.write(u["default"].writeUint32(e.offset))):a.write(u["default"].writeUint32(16777216))}),a.buffer}},{key:"sdtp",value:function(t){var n=new u["default"];return n.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){n.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),n.buffer}},{key:"mdat",value:function(t){var n=new u["default"],r=8;return t.samples.forEach(function(e){r+=e.size}),n.write(e.size(r),e.type("mdat")),t.samples.forEach(function(e){n.write(e.buffer)}),n.buffer}}]),e}();f.sequence=1,t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),u=r(s),o=n(35),f=r(o),d=n(36),l=r(d),c=n(3),h=r(c),p=n(79),v=r(p),m=n(6),y=r(m),g=n(80),w=r(g),b=n(7),k=r(b),U=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.pow(25,4);i(this,e),(0,u["default"])(this),this.url=t,this.CHUNK_SIZE=n,this.init(t),this.once("moovReady",this.moovParse.bind(this)),this.cache=new h["default"],this.bufferCache=new Set,this.timeRage=[],this.canDownload=!0}return a(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,r=this;return new Promise(function(i,a){var s=new y["default"](e.url,[t,n],i);
s.once("error",function(e){r.emit("error",e)})})}},{key:"moovParse",value:function(){var e=this,t=this,n=this.moovBox,r=w["default"].findBox(n,"mvhd"),i=w["default"].findBox(n,"trak"),a=void 0,s=void 0,u=void 0,o=void 0,d=void 0,l=void 0,c=void 0,h=void 0,p=void 0,v=void 0,m=void 0,y=void 0,g=void 0,b=void 0;i.forEach(function(e){var n=w["default"].findBox(e,"hdlr"),r=w["default"].findBox(e,"mdhd");if(!n||!r)return void t.emit("error",new k["default"]("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}));var i=w["default"].findBox(e,"stsd"),f=i.subBox[0];if("vide"===n.handleType){var U=w["default"].findBox(e,"avcC"),_=w["default"].findBox(e,"avc1");a=e,d=r.timescale,U?(u=f.type+"."+w["default"].toHex(U.profile,U.profileCompatibility,U.AVCLevelIndication).join(""),c=U.sequence&&U.sequence.map(function(e){return Number("0x"+e)}),h=U.pps&&U.pps.map(function(e){return Number("0x"+e)}),p=U.profile):u=""+f.type,_&&(v=_.width,m=_.height)}if("soun"===n.handleType){s=e;var E=w["default"].findBox(e,"esds"),x=w["default"].findBox(e,"mp4a"),T=w["default"].findBox(e,5);l=r.timescale,o=E?f.type+"."+w["default"].toHex(E.subBox[0].subBox[0].typeID)+("."+E.subBox[0].subBox[0].subBox[0].type):""+f.type,T&&T.EScode&&(b=T.EScode.map(function(e){return Number("0x"+e)})),x&&(y=x.channelCount,g=x.sampleRate)}}),this.videoTrak=(0,f["default"])({},a),this.audioTrak=(0,f["default"])({},s);var U=this._boxes.find(function(e){return"mdat"===e.type}),_=w["default"].seekTrakDuration(a,d),E=w["default"].seekTrakDuration(s,l);this.mdatStart=U.start;var x=this.videoKeyFrames,T=x.length-1;x.forEach(function(t,n){T>n?e.timeRage.push([t.time.time/d,x[n+1].time.time/d]):e.timeRage.push([t.time.time/d,-1])}),this.meta={videoCodec:u,audioCodec:o,createTime:r.createTime,modifyTime:r.modifyTime,duration:r.duration/r.timeScale,timeScale:r.timeScale,videoDuration:_,videoTimeScale:d,audioDuration:E,audioTimeScale:l,endTime:Math.min(_,E),sps:c,pps:h,width:v,height:m,profile:p,pixelRatio:[1,1],channelCount:y,sampleRate:g,audioConfig:b}}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var n=void 0,r=0,i=void 0,a=void 0;try{n=new l["default"](t)}catch(s){return e.emit("error",s.type?s:new k["default"]("parse","",{line:176,handle:"[MP4] init",msg:s.message})),!1}if(e._boxes=a=n.boxes,a.every(function(t){return r+=t.size,"moov"===t.type?(i=t,e.moovBox=i,e.emit("moovReady",i),!1):!0}),!i){var u=n.nextBox;u?"moov"===u.type?e.getData(r,r+u.size+28).then(function(t){var n=new l["default"](t);e._boxes=e._boxes.concat(n.boxes),i=n.boxes.filter(function(e){return"moov"===e.type}),i.length?(e.moovBox=i[0],e.emit("moovReady",i)):e.emit("error",new k["default"]("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))}):e.emit("error",new k["default"]("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(r,"").then(function(t){var n=new l["default"](t);n?(e._boxes=e._boxes.concat(n.boxes),n.boxes.every(function(t){return"moov"===t.type?(i=t,e.moovBox=i,e.emit("moovReady",i),!1):!0})):e.emit("error",new k["default"]("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))})}})["catch"](function(){e.emit("error",new k["default"]("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],n=arguments[2],r="video"===e?this.videoTrak:this.audioTrak,i=w["default"].findBox(r,"stsc"),a=w["default"].findBox(r,"stsz"),s=w["default"].findBox(r,"stts"),u=w["default"].findBox(r,"stco"),o=w["default"].findBox(r,"ctts"),f=this.mdatStart,d=[];if(n=void 0!==n?n:a.entries.length,t instanceof Array)t.forEach(function(e,t){d.push({idx:e,size:a.entries[e],time:w["default"].seekSampleTime(s,o,e),offset:w["default"].seekSampleOffset(i,u,a,e,f)})});else if(0!==n)for(var l=t;n>l;l++)d.push({idx:l,size:a.entries[l],time:w["default"].seekSampleTime(s,o,l),offset:w["default"].seekSampleOffset(i,u,a,l,f)});else d={idx:t,size:a.entries[t],time:w["default"].seekSampleTime(s,o,t),offset:w["default"].seekSampleOffset(i,u,a,t,f)};return d}},{key:"packMeta",value:function(){if(this.meta){var e=new h["default"];return e.write(v["default"].ftyp()),e.write(v["default"].moov(this.meta)),this.cache.write(e.buffer),e.buffer}}},{key:"seek",value:function(e){e=e||0;var t=e*this.meta.videoTimeScale,n=void 0,r=this.videoKeyFrames,i=this.audioKeyFrames;return r.every(function(e,i){var a=e.time.time,s=r[i+1]?r[i+1].time.time:Number.MAX_SAFE_INTEGER;return t>=a&&s>t?(n=i,!1):!0}),i.every(function(e,r){var a=e.startTime,s=i[r+1]?i[r+1].startTime:Number.MAX_SAFE_INTEGER;return t>=a&&s>t?(n=Math.min(r,n),!1):!0}),this.bufferCache.has(n)?Promise.resolve(null):this.loadFragment(n)}},{key:"loadFragment",value:function(e){var t=void 0,n=void 0,r=this.videoKeyFrames[e],i=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);if(t=Math.min(r.offset,i.offset),e<this.videoKeyFrames.length-1){var a=this.videoKeyFrames[e+1],s=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0);n=Math.max(a.offset,s.offset)}var u=this;return window.isNaN(t)||void 0!==n&&window.isNaN(n)?(u.emit("error",new k["default"]("parse","",{line:366,handle:"[MP4] loadFragment",url:u.url})),!1):this.bufferCache.has(e)?Promise.resolve(null):this.getData(t+u.mdatStart,n?u.mdatStart+n:"").then(function(n){return u.createFragment(new Uint8Array(n),t,e)})}},{key:"addFragment",value:function(e){var t=new h["default"];return t.write(v["default"].moof(e)),t.write(v["default"].mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,n){var r=this,i=[];this.bufferCache.add(n);var a=r.videoKeyFrames.map(function(e){return e.idx}),s=r.getSamplesByOrders("video",a[n],a[n+1]),u=s.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});i.push(this.addFragment({id:1,time:s[0].time.time,firstFlags:33554432,flags:3841,samples:u}));var o=this.getSamplesByOrders("audio",this.audioKeyFrames[n].order,this.audioKeyFrames[n+1]?this.audioKeyFrames[n+1].order:void 0),f=o.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});i.push(this.addFragment({id:2,time:o[0].time.time,firstFlags:0,flags:1793,samples:f}));var d=0;i.every(function(e){return d+=e.byteLength,!0});var l=new Uint8Array(d),c=0;return i.every(function(e){return l.set(e,c),c+=e.byteLength,!0}),Promise.resolve(l)}},{key:"destroy",value:function(){y["default"].clear(this.url),this.bufferCache.clear(),this.timeRage=[]}},{key:"clear",value:function(){this.bufferCache.clear(),this.timeRage=[]}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=w["default"].findBox(e,"stss"),n=this.getSamplesByOrders("video",t.entries.map(function(e){return e-1}));return this._videoFrames=n,n}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e=w["default"].findBox(this.videoTrak,"mdhd").timescale,t=w["default"].findBox(this.audioTrak,"mdhd").timescale,n=w["default"].findBox(this.audioTrak,"stts").entry,r=this.videoKeyFrames,i=[];return i=r.map(function(r){return w["default"].seekOrderSampleByTime(n,t,r.time.time/e)}),this._audioFrames=i,this._audioFrames}}]),e}();t["default"]=U,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return!!e&&"object"==typeof e}function i(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||a(e)}function a(e){return e.$$typeof===h}function s(e){return Array.isArray(e)?[]:{}}function u(e,t){return t.clone!==!1&&t.isMergeableObject(e)?d(s(e),e,t):e}function o(e,t,n){return e.concat(t).map(function(e){return u(e,n)})}function f(e,t,n){var r={};return n.isMergeableObject(e)&&Object.keys(e).forEach(function(t){r[t]=u(e[t],n)}),Object.keys(t).forEach(function(i){n.isMergeableObject(t[i])&&e[i]?r[i]=d(e[i],t[i],n):r[i]=u(t[i],n)}),r}function d(e,t,n){n=n||{},n.arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||l;var r=Array.isArray(t),i=Array.isArray(e),a=r===i;return a?r?n.arrayMerge(e,t,n):f(e,t,n):u(t,n)}n.r(t);var l=function(e){return r(e)&&!i(e)},c="function"==typeof Symbol&&Symbol["for"],h=c?Symbol["for"]("react.element"):60103;d.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return d(e,n,t)},{})};var p=d;t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),s=r(a),u=n(5),o=r(u),f=n(1),d=r(f),l=n(37);l.keys().forEach(function(e){l(e)});var c=function h(e){i(this,h),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;var t=this;t.buffer?(0,o["default"])(Uint8Array,t.buffer,e):t.buffer=e;var n=e.byteLength;e.position=0;for(var r=new d["default"](e);n-r.position>=8;){var a=new s["default"];if(a.readHeader(r),a.size-8<=n-r.position)a.readBody(r),t.boxes.push(a);else{if("mdat"!==a.type){t.nextBox=a,r.position-=8;break}a.readBody(r),t.boxes.push(a)}}t.buffer=new Uint8Array(t.buffer.slice(r.position))};t["default"]=c,e.exports=t["default"]},function(e,t,n){function r(e){var t=i(e);return n(t)}function i(e){var t=a[e];if(!(t+1)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return t}var a={"./MP4DecConfigDescrTag.js":38,"./MP4DecSpecificDescrTag.js":39,"./MP4ESDescrTag.js":40,"./SLConfigDescriptor.js":41,"./avc1.js":42,"./avcC.js":43,"./btrt.js":44,"./co64.js":45,"./ctts.js":46,"./dref.js":47,"./elst.js":48,"./esds.js":49,"./ftyp.js":50,"./hdlr.js":51,"./hmhd.js":52,"./iods.js":53,"./mdat.js":54,"./mdhd.js":55,"./mfhd.js":56,"./mp4a.js":57,"./mvhd.js":58,"./nmhd.js":59,"./pasp.js":60,"./sbgp.js":61,"./sdtp.js":62,"./smhd.js":63,"./stco.js":64,"./stsc.js":65,"./stsd.js":66,"./stsh.js":67,"./stss.js":68,"./stsz.js":69,"./stts.js":70,"./stz2.js":71,"./tfhd.js":72,"./tkhd.js":73,"./traf.js":74,"./trun.js":75,"./udta.js":76,"./url.js":77,"./vmhd.js":78};r.keys=function(){return Object.keys(a)},r.resolve=i,e.exports=r,r.id=37},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].MP4DecConfigDescrTag=function(e){var t=new a["default"],n=void 0;return t.type=e.readUint8(),n=e.readUint8(),128===n?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=u["default"].readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(a["default"].MP4DecSpecificDescrTag(e)),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i);a["default"].MP4DecSpecificDescrTag=function(e){var t=new a["default"],n=void 0,r=void 0;t.type=e.readUint8(),n=e.readUint8(),128===n?(t.extend=!0,e.skip(2),n=e.readUint8()+5,r=n-5):(r=n,n+=2),t.size=n;for(var i=[],s=0;r>s;s++)i.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=i,delete t.subBox,t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i);a["default"].MP4ESDescrTag=function(e){var t=new a["default"],n=void 0;return t.type=e.readUint8(),n=e.readUint8(),128===n?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(a["default"].MP4DecConfigDescrTag(e)),t.subBox.push(a["default"].SLConfigDescriptor(e)),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i);a["default"].SLConfigDescriptor=function(e){var t=new a["default"],n=void 0;return t.type=e.readUint8(),n=e.readUint8(),128===n?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.SL=e.readUint8(),delete t.subBox,t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].avc1=function(){var e=new u["default"](this.data),t=this;e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var n=0;31>n;n++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var r=new a["default"];r.readHeader(e),t.subBox.push(r),r.readBody(e)}delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].avcC=function(){var e=new u["default"](this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=(3&e.readUint8())+1,this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var n=[],r=0;t>r;r++)n.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var i=e.readUint16();this.ppsLength=i;for(var a=[],s=0;i>s;s++)a.push(Number(e.readUint8()).toString(16));this.pps=a,this.sequence=n;for(var o=[],f=e.dataview.byteLength;e.position<f;)o.push(e.readUint8());this.last=o,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].btrt=function(){var e=new u["default"](this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].co64=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;r>n;n++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].ctts=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var n=0,r=this.entryCount;r>n;n++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].dref=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var n=this,r=0;t>r;r++){var i=new a["default"];n.subBox.push(i),i.read(e)}delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].elst=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3);var t=[],n=e.readUint32();this.entries=t;for(var r=0;n>r;r++){var i={};t.push(i),1===this.version?(i.segment_duration=e.readUint64(),i.media_time=e.readUint64()):(i.segment_duration=e.readUint32(),i.media_time=e.readInt32()),i.media_rate_integer=e.readInt16(),i.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].esds=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3);var t=a["default"].MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].ftyp=function(){var e=new u["default"](this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],n=0,r=Math.floor((e.buffer.byteLength-8)/4);r>n;n++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].hdlr=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].iods=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3);for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i);a["default"].mdat=function(){delete this.subBox}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s),o=n(8),f=r(o);a["default"].mdhd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new f["default"]).setTime(1e3*this.create),this.modifyTime=(new f["default"]).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new f["default"]).setTime(1e3*this.create),this.modifyTime=(new f["default"]).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].mp4a=function(){var e=new u["default"](this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new a["default"];t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s),o=n(8),f=r(o);a["default"].mvhd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new f["default"]).setTime(1e3*this.create),this.modifyTime=(new f["default"]).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),u["default"].readByte(e.dataview,8),u["default"].readByte(e.dataview,2);for(var t=[],n=0;9>n;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,u["default"].readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data}},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].pasp=function(){var e=new u["default"](this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].smhd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stco=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;r>n;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stsc=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;r>n;n++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var i,a,s=0,o=this.count;o-1>s;s++)i=t[s],a=t[s-1],i.chunk_count=t[s+1].first_chunk-i.first_chunk,i.first_sample=0===s?1:a.first_sample+a.chunk_count*a.samples_per_chunk;if(1===this.count){var f=t[0];f.first_sample=1,f.chunk_count=0}else if(this.count>1){var d=t[this.count-1],l=t[this.count-2];d.first_sample=l.first_sample+l.chunk_count*l.samples_per_chunk,d.chunk_count=0}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stsd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new a["default"];t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stss=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;r>n;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stsz=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;r>n;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].stts=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],n=0,r=this.count;r>n;n++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s),o=n(8),f=r(o);a["default"].tkhd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=u["default"].readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new f["default"]).setTime(1e3*this.create),this.modifyTime=(new f["default"]).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new f["default"]).setTime(1e3*this.create),this.modifyTime=(new f["default"]).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],n=0;9>n;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i);a["default"].udta=function(){delete this.subBox}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"]["url "]=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(0),a=r(i),s=n(1),u=r(s);a["default"].vmhd=function(){var e=new u["default"](this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),u=r(s),o=Math.pow(2,32)-1,f=function(){function e(){i(this,e)}return a(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return u["default"].writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new u["default"];return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var n=new u["default"],r=8,i=e.mvhd(t.duration,t.timeScale),a=e.videoTrak(t),s=e.audioTrak(t),o=e.mvex(t.duration,t.timeScale);return[i,a,s,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moov"),i,a,s,o),n.buffer}},{key:"mvhd",value:function(t,n){var r=new u["default"];t*=n;var i=Math.floor(t/(o+1)),a=Math.floor(t%(o+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.write(e.size(8+s.length),e.type("mvhd"),new Uint8Array(s)),r.buffer}},{key:"videoTrak",value:function(t){var n=new u["default"],r=8,i=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),a=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,a),n.buffer}},{key:"audioTrak",value:function(t){var n=new u["default"],r=8,i=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),a=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,samplerate:t.sampleRate,audioConfig:t.audioConfig});return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),i,a),n.buffer}},{key:"tkhd",value:function(t){var n=new u["default"],r=t.id,i=t.duration*t.timeScale,a=t.width,s=t.height,f=t.type,d=Math.floor(i/(o+1)),l=Math.floor(i%(o+1)),c=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,"video"===f?1:0,"audio"===f?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]);return n.write(e.size(8+c.byteLength),e.type("tkhd"),c),n.buffer}},{key:"edts",value:function(t){var n=new u["default"],r=t.duration,i=t.mediaTime;return n.write(e.size(36),e.type("edts")),n.write(e.size(28),e.type("elst")),n.write(new Uint8Array([0,0,0,1,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,1])),n.buffer}},{key:"mdia",value:function(t){var n=new u["default"],r=8,i=e.mdhd(t.timescale),a=e.hdlr(t.type),s=e.minf(t);return[i,a,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("mdia"),i,a,s),n.buffer}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new u["default"];n*=t;var i=Math.floor(n/(o+1)),a=Math.floor(n%(o+1)),s=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]);return r.write(e.size(12+s.byteLength),e.type("mdhd"),e.extension(1,0),s),r.buffer}},{key:"hdlr",value:function(t){var n=new u["default"],r=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(r.splice.apply(r,[8,4].concat([115,111,117,110])),r.splice.apply(r,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),n.write(e.size(8+r.length),e.type("hdlr"),new Uint8Array(r)),n.buffer}},{key:"minf",value:function(t){var n=new u["default"],r=8,i="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),s=e.stbl(t);return[i,a,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("minf"),i,a,s),n.buffer}},{key:"vmhd",value:function(){var t=new u["default"];return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new u["default"];return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new u["default"],n=[0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1];return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array(n)),t.buffer}},{key:"stbl",value:function(t){var n=new u["default"],r=8,i=e.stsd(t),a=e.stts(),s=e.stsc(),o=e.stsz(),f=e.stco();return[i,a,s,o,f].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("stbl"),i,a,s,o,f),n.buffer}},{key:"stsd",value:function(t){var n=new u["default"],r=void 0;return r="audio"===t.type?e.mp4a(t):e.avc1(t),n.write(e.size(16+r.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),r),n.buffer}},{key:"mp4a",value:function(t){var n=new u["default"],r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=e.esds(t.audioConfig);return n.write(e.size(8+r.byteLength+i.byteLength),e.type("mp4a"),r,i),n.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],n=t.length,r=new u["default"],i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(t).concat([6,1,2]));return r.write(e.size(8+i.byteLength),e.type("esds"),i),r.buffer}},{key:"avc1",value:function t(n){var r=new u["default"],i=40,a=n.sps,s=n.pps,o=n.width,f=n.height,d=n.pixelRatio[0],l=n.pixelRatio[1],c=new Uint8Array([1,a[1],a[2],a[3],255,225].concat([a.length>>>8&255,255&a.length]).concat(a).concat(1).concat([s.length>>>8&255,255&s.length]).concat(s)),t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,f>>8&255,255&f,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),p=new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,l>>24,l>>16&255,l>>8&255,255&l]);
return r.write(e.size(i+t.byteLength+c.byteLength+h.byteLength),e.type("avc1"),t,e.size(8+c.byteLength),e.type("avcC"),c,e.size(20),e.type("btrt"),h,e.size(16),e.type("pasp"),p),r.buffer}},{key:"stts",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),n),t.buffer}},{key:"stsc",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),n),t.buffer}},{key:"stco",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),n),t.buffer}},{key:"stsz",value:function(){var t=new u["default"],n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),n),t.buffer}},{key:"mvex",value:function(t,n){var r=new u["default"],i=u["default"].writeUint32(t*n);return r.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),i,e.trex(1),e.trex(2)),r.buffer}},{key:"trex",value:function(t){var n=new u["default"],r=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.write(e.size(8+r.byteLength),e.type("trex"),r),n.buffer}},{key:"moof",value:function(t){var n=new u["default"],r=8,i=e.mfhd(),a=e.traf(t);return[i,a].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moof"),i,a),n.buffer}},{key:"mfhd",value:function(){var t=new u["default"],n=u["default"].writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),n),t.buffer}},{key:"traf",value:function(t){var n=new u["default"],r=8,i=e.tfhd(t.id),a=e.tfdt(t.time),s=e.sdtp(t),o=e.trun(t,s.byteLength);return[i,a,s,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("traf"),i,a,s,o),n.buffer}},{key:"tfhd",value:function(t){var n=new u["default"],r=u["default"].writeUint32(t);return n.write(e.size(16),e.type("tfhd"),e.extension(0,0),r),n.buffer}},{key:"tfdt",value:function(t){var n=new u["default"],r=Math.floor(t/(o+1)),i=Math.floor(t%(o+1));return n.write(e.size(20),e.type("tfdt"),e.extension(1,0),u["default"].writeUint32(r),u["default"].writeUint32(i)),n.buffer}},{key:"trun",value:function(t,n){var r=t.id,i=1===r?16:12,a=new u["default"],s=u["default"].writeUint32(t.samples.length),o=u["default"].writeUint32(96+i*t.samples.length+n);return a.write(e.size(20+i*t.samples.length),e.type("trun"),e.extension(0,t.flags),s,o),t.samples.forEach(function(e,t){a.write(u["default"].writeUint32(e.duration)),a.write(u["default"].writeUint32(e.size)),1===r?(a.write(u["default"].writeUint32(e.key?33554432:16842752)),a.write(u["default"].writeUint32(e.offset))):a.write(u["default"].writeUint32(16777216))}),a.buffer}},{key:"sdtp",value:function(t){var n=new u["default"];return n.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){n.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),n.buffer}},{key:"mdat",value:function(t){var n=new u["default"],r=8;return t.samples.forEach(function(e){r+=e.size}),n.write(e.size(r),e.type("mdat")),t.samples.forEach(function(e){n.write(e.buffer)}),n.buffer}}]),e}();f.sequence=1,t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};r.findBox=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var i=e.subBox.filter(function(e){return e.type===t});i.length?i.forEach(function(e){return n.push(e)}):e.subBox.forEach(function(e){return r.findBox(e,t,n)})}}else n.push(e);return n=[].concat(n),n.length>1?n:n[0]},r.padStart=function(e,t,n){for(var r=String(n),i=t>>0,a=Math.ceil(i/r.length),s=[],u=String(e);a--;)s.push(r);return s.join("").substring(0,i-u.length)+u},r.toHex=function(){for(var e=[],t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];return n.forEach(function(t){e.push(r.padStart(Number(t).toString(16),2,0))}),e},r.sum=function(){for(var e=0,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];return n.forEach(function(t){e+=t}),e},r.stscOffset=function(e,t){var n=void 0,r="",i=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(i){var a=Math.floor((t-i.first_sample)/i.samples_per_chunk),s=i.first_sample+a*i.samples_per_chunk;return n=i.first_chunk+a,r=[s,t],{chunk_index:n,samples_offset:r}}var u=e.entries.pop();e.entries.push(u);var o=Math.floor((t-u.first_sample)/u.samples_per_chunk),f=u.first_chunk+o,d=u.first_sample+u.samples_per_chunk*o;return{chunk_index:f,samples_offset:[d,t]}},r.seekSampleOffset=function(e,t,n,i,a){var s=r.stscOffset(e,i+1),u=t.entries[s.chunk_index-1]+r.sum.apply(null,n.entries.slice(s.samples_offset[0]-1,s.samples_offset[1]-1))-a;if(void 0===u)throw"result="+u+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));if(0>u)throw"result="+u+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));return u},r.seekSampleTime=function(e,t,n){var r=void 0,i=void 0,a=0,s=0,u=0;if(e.entry.every(function(e){return i=e.sampleDuration,n<a+e.sampleCount?(r=s+(n-a)*e.sampleDuration,!1):(a+=e.sampleCount,s+=e.sampleCount*i,!0)}),t){var o=0;t.entry.every(function(e){return o+=e.count,o>n?(u=e.offset,!1):!0})}return r||(r=s+(n-a)*i),{time:r,duration:i,offset:u}},r.seekOrderSampleByTime=function(e,t,n){var r=0,i=0,a=0,s=void 0;return e.every(function(e,u){return s=e.sampleCount*e.sampleDuration/t,r+s>=n?(i=a+Math.ceil((n-r)*t/e.sampleDuration),r+=Math.ceil((n-r)*t/e.sampleDuration)*e.sampleDuration/t,!1):(r+=s,a+=e.sampleCount,!0)}),{order:i,startTime:r}},r.seekTrakDuration=function(e,t){var n=r.findBox(e,"stts"),i=0;return n.entry.forEach(function(e){i+=e.sampleCount*e.sampleDuration}),Number(i/t).toFixed(4)},t["default"]=r,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),u=r(s),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001f, mp4a.40.2"';i(this,e),(0,u["default"])(this),this.codecs=t,this.queue=[],this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource)}return a(e,[{key:"init",value:function(){var e=this;return new Promise(function(t){var n=e,r=function a(){n.sourceBuffer=n.mediaSource.addSourceBuffer(n.codecs),n.sourceBuffer.addEventListener("error",function(e){n.emit("error",{type:"sourceBuffer",error:e})}),n.sourceBuffer.addEventListener("updateend",function(e){if(n.emit("updateend"),n.queue.length>0&&!n.sourceBuffer.updating){var t=n.queue.shift();n.sourceBuffer.appendBuffer(t.buffer),t.resolve(!0)}}),n.sourceBuffer.addEventListener("error",function(e){n.emit("error",{type:"mediaSource",error:e})}),n.mediaSource.removeEventListener("sourceopen",a),n.emit("sourceopen"),t(!0)},i=function s(){n.emit("sourceclose"),n.mediaSource.removeEventListener("sourceclose",s)};e.mediaSource.addEventListener("sourceopen",r),e.mediaSource.addEventListener("sourceclose",i)})}},{key:"appendBuffer",value:function(e){var t=this;return new Promise(function(n){var r=t.sourceBuffer;"open"===t.state?r.updating===!1&&0===t.queue.length?(r.appendBuffer(e),n(!0)):t.queue.push({buffer:e,resolve:n}):"ended"===t.state?(r.appendBuffer(e),n(!0)):"closed"===t.state&&n(!1)})}},{key:"removeBuffer",value:function(e,t){var n=this;return new Promise(function(r){n.sourceBuffer.updating!==!0||"closed"===n.state||"ended"===n.state?(n.sourceBuffer.remove(e,t),r(!0)):n.once("updateend",function(){n.removeBuffer(e,t),r(!0)})})}},{key:"abort",value:function(){var e=this;return new Promise(function(t){"closed"===e.state||"ended"===e.state?t(!0):"open"===e.state&&e.updating!==!0?(e.sourceBuffer.abort(),t(!0)):e.once("updateend",function(){"open"===e.state&&e.sourceBuffer.abort(),t(!0)})})}},{key:"endOfStream",value:function(){var e=this;return new Promise(function(t){"closed"===e.state||"ended"===e.state?t(!0):"open"===e.state&&e.updating!==!0?(e.mediaSource.endOfStream(),t(!0)):e.once("updateend",function(){"open"===e.state&&e.mediaSource.endOfStream(),t(!0)})})}},{key:"reset",value:function(){this.queue.forEach(function(e){e.resolve&&e.resolve(!1)}),this.queue=[]}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){var t=this;this.updating?this.once("updateend",function(){t.mediaSource.duration=e}):this.mediaSource.duration=e}},{key:"updating",get:function(){return this.sourceBuffer.updating}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}();t["default"]=o,e.exports=t["default"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};r.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=r,i.innerHTML=t,Object.keys(n).forEach(function(t){var r=t,a=n[t];"video"===e||"audio"===e?a&&i.setAttribute(r,a):i.setAttribute(r,a)}),i},r.hasClass=function(e,t){return e.classList?Array.prototype.some.call(e.classList,function(e){return e===t}):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},r.addClass=function(e,t){e.classList?t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(t){t&&e.classList.add(t)}):r.hasClass(e,t)||(e.className+=" "+t)},r.removeClass=function(e,t){e.classList?t.split(/\s+/g).forEach(function(t){e.classList.remove(t)}):r.hasClass(e,t)&&t.split(/\s+/g).forEach(function(t){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")})},r.toggleClass=function(e,t){t.split(/\s+/g).forEach(function(t){r.hasClass(e,t)?r.removeClass(e,t):r.addClass(e,t)})},r.findDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=arguments[1];return e.querySelector(t)},r.padStart=function(e,t,n){for(var r=String(n),i=t>>0,a=Math.ceil(i/r.length),s=[],u=String(e);a--;)s.push(r);return s.join("").substring(0,i-u.length)+u},r.format=function(e){if(window.isNaN(e))return"";var t=r.padStart(Math.floor(e/3600),2,0),n=r.padStart(Math.floor((e-3600*t)/60),2,0),i=r.padStart(Math.floor(e-3600*t-60*n),2,0);return("00"===t?[n,i]:[t,n,i]).join(":")},r.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},r.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},r.deepCopy=function(e,t){return"Object"===r.typeOf(t)&&"Object"===r.typeOf(e)?(Object.keys(t).forEach(function(n){"Object"!==r.typeOf(t[n])||t[n]instanceof Node?"Array"===r.typeOf(t[n])?e[n]="Array"===r.typeOf(e[n])?e[n].concat(t[n]):t[n]:e[n]=t[n]:e[n]?r.deepCopy(e[n],t[n]):e[n]=t[n]}),e):void 0},r.getBgImage=function(e){var t=document.createElement("a"),n=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;return t.href=n.replace(/url\("|"\)/g,""),t.href},r.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,function(e){t.setAttribute(e.name,e.value)}),t}return""},r.setInterval=function(e,t,n,r){e._interval[t]||(e._interval[t]=setInterval(n.bind(e),r))},r.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},t["default"]=r,e.exports=t["default"]}])});